// Generated by CoffeeScript 1.9.3
var reloadCaptcha, setRequired, submitRegistration;

reloadCaptcha = function() {
  return apiCall("GET", "/api/user/status", {}).done(function(data) {
    if (data.data.enable_captcha) {
      grecaptcha.reset();
    }
    return ga('send', 'event', 'Registration', 'NewCaptcha');
  });
};

setRequired = function() {
  return $('#user-registration-form :input').each(function() {
    if (!$(this).is(':checkbox')) {
      if (!$(this).is(':radio')) {
        return $(this).prop('required', $(this).is(":visible"));
      }
    }
  });
};

submitRegistration = function(e) {
  var registrationData;
  e.preventDefault();
  registrationData = $("#user-registration-form").serializeObject();
  return apiCall("POST", "/api/user/create_simple", registrationData).done(function(data) {
    switch (data['status']) {
      case 0:
        $(submitButton).apiNotify(data, {
          position: "right"
        });
        ga('send', 'event', 'Registration', 'Failure', logType + "::" + data.message);
        return grecaptcha.reset();
      case 1:
        return document.location.href = "/profile";
    }
  });
};

$(function() {
  apiCall("GET", "/api/user/status", {}).done(function(data) {
    if (data.data.enable_captcha) {
      return grecaptcha.render("captcha", {
        "sitekey": data.data.recaptchaPublicKey
      });
    }
  });
  return $("#user-registration-form").on("submit", submitRegistration);
});
